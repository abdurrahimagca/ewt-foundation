{% block response %}

    {# orderId'yi Query Parametresinden Alıyoruz #}
    {% set orderId = hook.query['orderId'] %}

   

    {# Body İçinden customFields Alıyoruz #}
    {% set customFields = hook.request.customFields %}

    {# Gerekli Parametre Kontrolü #}
    {% if not orderId %}
        {% set errorResponse = services.response.json({
            "error": "orderId is required.",
            "receivedData": requestData
        }) %}
        {% do hook.setResponse(errorResponse) %}
        {% return %}
    {% endif %}

    {% if not customFields %}
        {% set errorResponse = services.response.json({
            "error": "customFields are required.",
            "receivedData": requestData
        }) %}
        {% do hook.setResponse(errorResponse) %}
        {% return %}
    {% endif %}

    {# Custom Field Data Yapısı #}
    {% set updateData = [{
        "id": orderId,
        "customFields": customFields
    }] %}

    {# Custom Field Update (Güncelleme) #}
    {% do services.writer.upsert('order', updateData) %}

    {# Başarılı Yanıt #}
    {% set response = services.response.json({
        "message": "Custom fields updated for order " ~ orderId,
        "customFields": customFields
    }) %}
    
    {# Cache'i Devre Dışı Bırakıyoruz #}
    {% do response.cache.disable() %}
    {% do hook.setResponse(response) %}

{% endblock %}
